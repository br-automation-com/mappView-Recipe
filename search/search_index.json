{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Introduction Requirements Revision History Introduction This is a sample project for a recipe management with mappView. It uses B&R mappRecipe to access the recipe data and supports up to 3 concurrent web clients as well as Unicode recipe names. Unicode names are required for language that require special fonts (Chinese, Japanese, Russian, ..). Also see How to import the user management into an existing project. Download the latest release from here. When upgrading from a previous version make sure to delete the files that were imported before. Detailed information are available in the Wiki . This sample can run in simualtion mode (http://127.0.0.1:81/). Requirements Automation Studio 4.9 mappView 5.15 mappServices 5.15 Automation Runtime C4.90 Recommended task class is #8 with a 10ms cycle time. Revision History Version 1.6 (30.05.2022) Fixed rename command can cause memory violation and crash PLC","title":"Home"},{"location":"#introduction","text":"This is a sample project for a recipe management with mappView. It uses B&R mappRecipe to access the recipe data and supports up to 3 concurrent web clients as well as Unicode recipe names. Unicode names are required for language that require special fonts (Chinese, Japanese, Russian, ..). Also see How to import the user management into an existing project. Download the latest release from here. When upgrading from a previous version make sure to delete the files that were imported before. Detailed information are available in the Wiki . This sample can run in simualtion mode (http://127.0.0.1:81/).","title":"Introduction"},{"location":"#requirements","text":"Automation Studio 4.9 mappView 5.15 mappServices 5.15 Automation Runtime C4.90 Recommended task class is #8 with a 10ms cycle time.","title":"Requirements"},{"location":"#revision-history","text":"","title":"Revision History"},{"location":"#version-16-30052022","text":"Fixed rename command can cause memory violation and crash PLC","title":"Version 1.6 (30.05.2022)"},{"location":"wiki/","text":"Description Pre Configuration Performance Error numbers Limitations Revision History Description The sample consists of two main components. The sample page is used to operate the recipe management. The task Recipe_01 drives the recipe management. Ideally this task should not be changed to make future updates easier. All additional code should be added to 'YourTask'. The following functions are currently supported. Load and Save recipes View recipes Create new recipes Delete recipes Rename recipes Download and upload recipes Recipes can be downloaded directly from the web client. To support this function the recipes must be loaded into memory. A buffer of the size REC_UPLOAD_DOWNLOAD_SIZE is used to hold the data into the memory. If the recipes exceed REC_UPLOAD_DOWNLOAD_SIZE the constant must be increased. Recipe upload is supported for ASCII recipe mode (REC_USE_UNICODE=false). Up to 3 web clients can connect at the same time. While the task itself can only execute one command at a time the commands are executed so fast that this should not be an issue. The init command may take longer but the response data is distributed to all sessions. The task uses a variable structure to communicate with the outside world that can also be used to interact with other tasks. The structure Recipe_01 looks as follows: Level 1 Level 2 Level Description CMD Used to trigger commands like load, save, delete, ... A command is triggered by setting it to true, when the command is finished the task will reset the command. This indicates that the command is finished. Do not change any parameters or set another command until the previous command is finished. Init Initializes the recipe management and reads the names of all recipes. New Create a new recipe, triggers an error message if the recipe name already exists. Load Loads the recipe data. Save Saves the recipe data. View View selected recipe. Rename Renames the selected recipe. Delete Deletes the selected recipe. Download Download selected recipe. Upload Upload a recipe via web browser to the taret. ErrorReset Resets pending errors. PAR Parameters like recipe name, file path, ... RecipeName The name of the recipe used with the current command. RecipeNameNew New name used with the command rename. RecipeID File name of the recipe. With standard strings this equal the recipe name. Increasing numbers are used for Unicode recipe names. The recipe name is then stored as Unicode inside the recipe itself. Initialized Shows that the recipe management was initialized correct. VisuSlotID This is the session ID for the current command. This is used to identify where to send response messages. VisuEnableCommand Enable or disable commands when number of recipes is 0 or command is running. DAT Recipe lists as well as status information. RecipeNames List with all recipe names. RecipeIDs File names for the corresponding recipe name. RecipeNum Number of recipes in the list. VIS Data specific for the visualization. The structure is an array, one for each client session. RecipeNames List with all recipes formatted as data provider for the mappView listbox. RecipeNum Number of visible recipes in the list. Depending on the filter this number can be lower than the total number of recipes stored under DAT. RecipeFilter Only show recipes that contain this string pattern. RecipeSelect Used to select the recipe name after command new or rename. DownloadFileUrl Url containing the file name that is downloaded. UploadOverwriteRequest Show message box to overwrite file. UploadOverwriteResponse Response from message box overwrite file. ReloadUpload Reload upload button. RecipeDoubleClick Helper variable to detect a double click on a record. When a double click is detected, the recipe is opened. ViewFilePath File path used for the web widget that shows the file content. ViewFile Trigger to open the fly out window and view the file content. ShowMessageBoxError Show a message box when command was not successful. ERR Information about errors. State State where the error occurred. Text Error text. StatusText Shows the result for the last command. StatusNo Shows the status as number Pre-Configuration The task communicates with the outside world via the global structure 'Recipe_01'. If more than one recipe management is needed the complete package 'mappRecipe' should be duplicated. It is important that the new task name and new global structure use the same name. After importing the sample go to the package 'mappRecipe' and edit the file 'RecVariables.var'. The variable array 'REC_VAR_LIST' contains the name of the variables that contain the recipe data. The default variable has a few sample values. After importing the task these can be replaced with \"real\" variables that should be saved. The variables can be standard type but also arrays or structures. The following constants can be adjusted if necessary. Constant Default Text REC_USE_UNICODE TRUE When set the to false the recipe name equals the file name. Use this setting for better performance when no special characters are needed. When set to true an increasing number is used for the file name instead. The recipe name is then stored as Unicode inside the recipe itself. Execute a clean configuration and rebuilt the project after changing this value. When set to to TRUE recipe upload is not supported. REC_SORT_NUMERIC FALSE Sort recipe names as numeric values instead of alphabetic. REC_RECIPE_TYPE typeCSV Select typeCSV for recipes in CSV file format or select typeXML for XML format. Execute a clean configuration and rebuilt the project after changing this value. REC_MPLINK gRecipeCsv_01 mappRecipe link name from configuration view. Use gRecipeCsv_01 for CSV and gRecipeXml_01 for XML in this demo. REC_DEVICE RECIPE_DEVICE Device name for the recipe data defined under File Devices in the CPU configuration. REC_DIRECTORY Recipe_01 Directory where the recipes are stored. REC_THIS_TASK Recipe_01 Name of this task and the global variable's structure. REC_REC_NUM 100 Maximum number of recipes. REC_VAR_NUM 10 Maximum number of variables that can be registered. REC_NAME_LENGTH 40 Maximum length for a recipe name. REC_UPLOAD_DOWNLOAD_SIZE 100000 Maximum size of files that can be uploaded or downloaded REC_VIS_LENGTH 120 Make this REC_NAME_LENGTH x 3. REC_MAX_CLIENTS_ID 2 Maximum number of concurrent web client connections. Do not change this number. REC_VIEW_FILTER csv, xml File extensions that can be used with the view command. The filter is case sensitive. REC_VAR_LIST List of variables to be included in a recipe. Performance When calling the init command the task needs some time to generate the list of recipe names. On a X20CP1583 running the task in a 10ms task class the init command needs about 20ms per recipe plus 150ms. So for 100 recipes the task needs 2.15 seconds to read all recipe names when using standard strings. When using Unicode strings the task needs 70ms per recipe name plus 200ms. So for 100 recipes the task needs 7.20 seconds to read all recipe names when using Unicode strings. Error The task generates the following list of error messages. All other error numbers are generated from included libraries that can be found in the Automation Studio help. No Constant Text 50010 ERR_REC_TOO_MANY_CLIENTS More than 3 clients try to connect to user management 50100 ERR_REC_NAME_EMPTY Recipe name is empty 50101 ERR_REC_NAME_EXISTS Recipe name already exists 50102 ERR_REC_NAME_LOST Recipe name was not found 50103 ERR_REC_NAME_LENGTH One or more recipe names exceeds maximum length 50110 ERR_REC_DEV_NAME_EMPTY Device name is empty 50120 ERR_REC_VAR_NAME_EMPTY Variable name is empty 50130 ERR_REC_NOT_INITIALIZED Recipe management is not initialized 50140 ERR_REC_MAX_NUM Maximum number of recipes reached 50150 ERR_REC_TASK_NAME Task name is incorrect. Make sure task name and global variable structure share the same name and that the string \"this\" is correct in the init task. 50300 ERR_MEM_ALLOC Memory allocation for file upload and download failed 50310 ERR_MEM_DOWNLOAD Size of download file exceeds maximum 50320 ERR_TIMEOUT_DOWNLOAD Download response timed out 50330 ERR_DIR_DOWNLOAD Directories cannot be downloaded 50400 ERR_SIZE_NAME_UPLOAD Cannot find filename in upload response 50401 ERR_POS_NAME_UPLOAD Cannot determine end of filename in upload response 50402 ERR_LEN_NAME_UPLOAD Filename is too long in upload response 50403 ERR_POS_DATA_UPLOAD Cannot find data in upload response 50404 ERR_SIZE_DATA_UPLOAD Cannot determine end of data in upload response 50410 ERR_MEM_UPLOAD Size of upload file exceeds maximum size 50420 ERR_UNICODE_UPLOAD Upload is not supported when Unicode is used Limitations Viewing a recipe only works for CSV files. Downloading and uploading currently does not work for Unicode recipes. Revision History Version 1.6 (30.05.2022) Fixed rename command can cause memory violation and crash PLC Version 1.5 (27.01.2022) Add recipe to list after save command when it does not exist Fixed typo in memory allocation status check Version 1.4 (18.10.2021) Version 1.4 (18.10.2021) - Added error message when recipe name is missing from Unicode recipe - Don't reset error when returning to wait state Version 1.3 (03.09.2021) Update project to Automation Studio 4.9 and mapp 5.15 Fixed an issue where the recipe management would not recover correct from an error Version 1.2 (15.04.2021) Fixed PLC crash when REC_VAR_NUM is 1 Version 1.1 (01.04.2021) Fixed upload file name can exceed REC_ITEM_LENGTH Version 1.0 (05.02.2021) Fixed memory violation when file exceeds download buffer size Reset error in wait state Errors in the wait state report the wrong trigger state Version 0.91 Wrong MpLink name now generates an error Moved status text up to main strutcure Moved error no up to main structure and renamed it to StatusNo Better recovering from errors Version 0.8 Changed some parameters to constants Simplified configuration Added better error messages Added the possibility to define multiple variables Version 0.7 Fixed recipe view does not show correct data on double click or command view Fixed ReplaceString function call Version 0.6 Option to sort recipe names as numeric values instead of alphabetic Code cleanup Renamed web controls to avoid conflicts with other samples Fixed download not working when downloading the same file again Fixed upload not working with large files > 1 MB Version 0.5 Added support for recipe upload over mappView Fixed renaming recipes in ASCII mode Version 0.4 Added support for recipe download over mappView Removed view file status message Code cleanup Version 0.3 Added categories to mapp function blocks to separate recipe data Added function to view files by double click or command Removed obsolete constants Version 0.2 Added message box before saving or deleting a recipe Fixed filter compare too short Added exit function Code cleanup Version 0.1 First public release","title":"Wiki"},{"location":"wiki/#description","text":"The sample consists of two main components. The sample page is used to operate the recipe management. The task Recipe_01 drives the recipe management. Ideally this task should not be changed to make future updates easier. All additional code should be added to 'YourTask'. The following functions are currently supported. Load and Save recipes View recipes Create new recipes Delete recipes Rename recipes Download and upload recipes Recipes can be downloaded directly from the web client. To support this function the recipes must be loaded into memory. A buffer of the size REC_UPLOAD_DOWNLOAD_SIZE is used to hold the data into the memory. If the recipes exceed REC_UPLOAD_DOWNLOAD_SIZE the constant must be increased. Recipe upload is supported for ASCII recipe mode (REC_USE_UNICODE=false). Up to 3 web clients can connect at the same time. While the task itself can only execute one command at a time the commands are executed so fast that this should not be an issue. The init command may take longer but the response data is distributed to all sessions. The task uses a variable structure to communicate with the outside world that can also be used to interact with other tasks. The structure Recipe_01 looks as follows: Level 1 Level 2 Level Description CMD Used to trigger commands like load, save, delete, ... A command is triggered by setting it to true, when the command is finished the task will reset the command. This indicates that the command is finished. Do not change any parameters or set another command until the previous command is finished. Init Initializes the recipe management and reads the names of all recipes. New Create a new recipe, triggers an error message if the recipe name already exists. Load Loads the recipe data. Save Saves the recipe data. View View selected recipe. Rename Renames the selected recipe. Delete Deletes the selected recipe. Download Download selected recipe. Upload Upload a recipe via web browser to the taret. ErrorReset Resets pending errors. PAR Parameters like recipe name, file path, ... RecipeName The name of the recipe used with the current command. RecipeNameNew New name used with the command rename. RecipeID File name of the recipe. With standard strings this equal the recipe name. Increasing numbers are used for Unicode recipe names. The recipe name is then stored as Unicode inside the recipe itself. Initialized Shows that the recipe management was initialized correct. VisuSlotID This is the session ID for the current command. This is used to identify where to send response messages. VisuEnableCommand Enable or disable commands when number of recipes is 0 or command is running. DAT Recipe lists as well as status information. RecipeNames List with all recipe names. RecipeIDs File names for the corresponding recipe name. RecipeNum Number of recipes in the list. VIS Data specific for the visualization. The structure is an array, one for each client session. RecipeNames List with all recipes formatted as data provider for the mappView listbox. RecipeNum Number of visible recipes in the list. Depending on the filter this number can be lower than the total number of recipes stored under DAT. RecipeFilter Only show recipes that contain this string pattern. RecipeSelect Used to select the recipe name after command new or rename. DownloadFileUrl Url containing the file name that is downloaded. UploadOverwriteRequest Show message box to overwrite file. UploadOverwriteResponse Response from message box overwrite file. ReloadUpload Reload upload button. RecipeDoubleClick Helper variable to detect a double click on a record. When a double click is detected, the recipe is opened. ViewFilePath File path used for the web widget that shows the file content. ViewFile Trigger to open the fly out window and view the file content. ShowMessageBoxError Show a message box when command was not successful. ERR Information about errors. State State where the error occurred. Text Error text. StatusText Shows the result for the last command. StatusNo Shows the status as number","title":"Description"},{"location":"wiki/#pre-configuration","text":"The task communicates with the outside world via the global structure 'Recipe_01'. If more than one recipe management is needed the complete package 'mappRecipe' should be duplicated. It is important that the new task name and new global structure use the same name. After importing the sample go to the package 'mappRecipe' and edit the file 'RecVariables.var'. The variable array 'REC_VAR_LIST' contains the name of the variables that contain the recipe data. The default variable has a few sample values. After importing the task these can be replaced with \"real\" variables that should be saved. The variables can be standard type but also arrays or structures. The following constants can be adjusted if necessary. Constant Default Text REC_USE_UNICODE TRUE When set the to false the recipe name equals the file name. Use this setting for better performance when no special characters are needed. When set to true an increasing number is used for the file name instead. The recipe name is then stored as Unicode inside the recipe itself. Execute a clean configuration and rebuilt the project after changing this value. When set to to TRUE recipe upload is not supported. REC_SORT_NUMERIC FALSE Sort recipe names as numeric values instead of alphabetic. REC_RECIPE_TYPE typeCSV Select typeCSV for recipes in CSV file format or select typeXML for XML format. Execute a clean configuration and rebuilt the project after changing this value. REC_MPLINK gRecipeCsv_01 mappRecipe link name from configuration view. Use gRecipeCsv_01 for CSV and gRecipeXml_01 for XML in this demo. REC_DEVICE RECIPE_DEVICE Device name for the recipe data defined under File Devices in the CPU configuration. REC_DIRECTORY Recipe_01 Directory where the recipes are stored. REC_THIS_TASK Recipe_01 Name of this task and the global variable's structure. REC_REC_NUM 100 Maximum number of recipes. REC_VAR_NUM 10 Maximum number of variables that can be registered. REC_NAME_LENGTH 40 Maximum length for a recipe name. REC_UPLOAD_DOWNLOAD_SIZE 100000 Maximum size of files that can be uploaded or downloaded REC_VIS_LENGTH 120 Make this REC_NAME_LENGTH x 3. REC_MAX_CLIENTS_ID 2 Maximum number of concurrent web client connections. Do not change this number. REC_VIEW_FILTER csv, xml File extensions that can be used with the view command. The filter is case sensitive. REC_VAR_LIST List of variables to be included in a recipe.","title":"Pre-Configuration"},{"location":"wiki/#performance","text":"When calling the init command the task needs some time to generate the list of recipe names. On a X20CP1583 running the task in a 10ms task class the init command needs about 20ms per recipe plus 150ms. So for 100 recipes the task needs 2.15 seconds to read all recipe names when using standard strings. When using Unicode strings the task needs 70ms per recipe name plus 200ms. So for 100 recipes the task needs 7.20 seconds to read all recipe names when using Unicode strings.","title":"Performance"},{"location":"wiki/#error","text":"The task generates the following list of error messages. All other error numbers are generated from included libraries that can be found in the Automation Studio help. No Constant Text 50010 ERR_REC_TOO_MANY_CLIENTS More than 3 clients try to connect to user management 50100 ERR_REC_NAME_EMPTY Recipe name is empty 50101 ERR_REC_NAME_EXISTS Recipe name already exists 50102 ERR_REC_NAME_LOST Recipe name was not found 50103 ERR_REC_NAME_LENGTH One or more recipe names exceeds maximum length 50110 ERR_REC_DEV_NAME_EMPTY Device name is empty 50120 ERR_REC_VAR_NAME_EMPTY Variable name is empty 50130 ERR_REC_NOT_INITIALIZED Recipe management is not initialized 50140 ERR_REC_MAX_NUM Maximum number of recipes reached 50150 ERR_REC_TASK_NAME Task name is incorrect. Make sure task name and global variable structure share the same name and that the string \"this\" is correct in the init task. 50300 ERR_MEM_ALLOC Memory allocation for file upload and download failed 50310 ERR_MEM_DOWNLOAD Size of download file exceeds maximum 50320 ERR_TIMEOUT_DOWNLOAD Download response timed out 50330 ERR_DIR_DOWNLOAD Directories cannot be downloaded 50400 ERR_SIZE_NAME_UPLOAD Cannot find filename in upload response 50401 ERR_POS_NAME_UPLOAD Cannot determine end of filename in upload response 50402 ERR_LEN_NAME_UPLOAD Filename is too long in upload response 50403 ERR_POS_DATA_UPLOAD Cannot find data in upload response 50404 ERR_SIZE_DATA_UPLOAD Cannot determine end of data in upload response 50410 ERR_MEM_UPLOAD Size of upload file exceeds maximum size 50420 ERR_UNICODE_UPLOAD Upload is not supported when Unicode is used","title":"Error"},{"location":"wiki/#limitations","text":"Viewing a recipe only works for CSV files. Downloading and uploading currently does not work for Unicode recipes.","title":"Limitations"},{"location":"wiki/#revision-history","text":"","title":"Revision History"},{"location":"wiki/#version-16-30052022","text":"Fixed rename command can cause memory violation and crash PLC","title":"Version 1.6 (30.05.2022)"},{"location":"wiki/#version-15-27012022","text":"Add recipe to list after save command when it does not exist Fixed typo in memory allocation status check","title":"Version 1.5 (27.01.2022)"},{"location":"wiki/#version-14-18102021","text":"Version 1.4 (18.10.2021) - Added error message when recipe name is missing from Unicode recipe - Don't reset error when returning to wait state","title":"Version 1.4 (18.10.2021)"},{"location":"wiki/#version-13-03092021","text":"Update project to Automation Studio 4.9 and mapp 5.15 Fixed an issue where the recipe management would not recover correct from an error","title":"Version 1.3 (03.09.2021)"},{"location":"wiki/#version-12-15042021","text":"Fixed PLC crash when REC_VAR_NUM is 1","title":"Version 1.2 (15.04.2021)"},{"location":"wiki/#version-11-01042021","text":"Fixed upload file name can exceed REC_ITEM_LENGTH","title":"Version 1.1 (01.04.2021)"},{"location":"wiki/#version-10-05022021","text":"Fixed memory violation when file exceeds download buffer size Reset error in wait state Errors in the wait state report the wrong trigger state","title":"Version 1.0 (05.02.2021)"},{"location":"wiki/#version-091","text":"Wrong MpLink name now generates an error Moved status text up to main strutcure Moved error no up to main structure and renamed it to StatusNo Better recovering from errors","title":"Version 0.91"},{"location":"wiki/#version-08","text":"Changed some parameters to constants Simplified configuration Added better error messages Added the possibility to define multiple variables","title":"Version 0.8"},{"location":"wiki/#version-07","text":"Fixed recipe view does not show correct data on double click or command view Fixed ReplaceString function call","title":"Version 0.7"},{"location":"wiki/#version-06","text":"Option to sort recipe names as numeric values instead of alphabetic Code cleanup Renamed web controls to avoid conflicts with other samples Fixed download not working when downloading the same file again Fixed upload not working with large files > 1 MB","title":"Version 0.6"},{"location":"wiki/#version-05","text":"Added support for recipe upload over mappView Fixed renaming recipes in ASCII mode","title":"Version 0.5"},{"location":"wiki/#version-04","text":"Added support for recipe download over mappView Removed view file status message Code cleanup","title":"Version 0.4"},{"location":"wiki/#version-03","text":"Added categories to mapp function blocks to separate recipe data Added function to view files by double click or command Removed obsolete constants","title":"Version 0.3"},{"location":"wiki/#version-02","text":"Added message box before saving or deleting a recipe Fixed filter compare too short Added exit function Code cleanup","title":"Version 0.2"},{"location":"wiki/#version-01","text":"First public release","title":"Version 0.1"}]}